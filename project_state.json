{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 15,
  "summary": "Squid Game: Red Light, Green Light browser game — fully refactored into a 3D experience. Three.js (React Three Fiber) renders a full-screen 3D world with ground plane, finish line, and a doll at the far end. A 3D player capsule moves along a straight track with a third-person camera. @mediapipe/pose (npm, client-side) handles body tracking with a webcam overlay in the bottom-right corner and real-time skeleton drawn on top. Movement detection uses smoothed landmark deltas across core body points (shoulders, hips). Game logic preserved: Green Light advances player only when movement detected, Red Light causes immediate elimination on movement, randomized timing, survival timer, 3-2-1 countdown, procedural Web Audio API sounds, adjustable sensitivity slider, win state when player reaches finish line. Code is modular: scene.ts, poseTracking.ts, movementDetection.ts, gameState.ts.",
  "architectural_notes": [
    "Use @mediapipe/pose npm package (bundled, not CDN) for pose detection",
    "Movement smoothing across recent frames to reduce false positives",
    "Progress advances only during Green Light when movement is detected; no movement = no progress",
    "Immediate elimination on Red Light if movement exceeds threshold — no grace period",
    "Procedural sounds via Web Audio API only (no external audio files)",
    "Use Three.js via React Three Fiber for full-screen 3D scene (ground plane, finish line, doll, player capsule)",
    "Third-person camera: slightly behind and above the player, following along straight track",
    "Webcam overlay in bottom-right corner with MediaPipe Pose skeleton drawn on top",
    "Modular structure: scene.ts, poseTracking.ts, movementDetection.ts, gameState.ts",
    "Elimination requires movement above threshold sustained for 200–300ms (time confirmation window) to prevent single-frame false triggers"
  ],
  "known_issues": [
    "Webcam feed blank in overlay and MediaPipe skeleton not rendering — video element not connected to canvas or pose tracking starting before video stream is ready"
  ],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-build-a-single-page-react-game-layout-with-a-squid-game-aesthetic-near-black-background-hot-pink-red-accents-ff0066-ff3333-stark-white-text-bold-cinematic-typography-and-a-full-viewport-dark-game-container",
      "title": "Build a single-page React game layout with a Squid Game aesthetic: near-black background, hot pink / red accents (#FF0066 / #FF3333), stark white text, bold cinematic typography, and a full-viewport dark game container.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-game-state-machine-with-the-following-states-idle-countdown-3-2-1-green-light-red-light-eliminated-and-won-randomize-green-red-light-durations-2-6-seconds-each-with-occasional-dramatic-long-red-light-holds",
      "title": "Implement game state machine with the following states: idle, countdown (3-2-1), green-light, red-light, eliminated, and won. Randomize green/red light durations (2–6 seconds each), with occasional dramatic long red-light holds.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-movement-detection-stub-using-the-device-webcam-via-getusermedia-draw-the-raw-webcam-feed-onto-a-canvas-element-compare-pixel-motion-data-frame-to-frame-no-pose-landmarks-yet-to-produce-a-movement-score-apply-smoothing-by-averaging-movement-scores-across-the-last-5-10-frames-to-reduce-false-positives",
      "title": "Create a movement detection stub using the device webcam via getUserMedia. Draw the raw webcam feed onto a canvas element. Compare pixel/motion data frame-to-frame (no pose landmarks yet) to produce a movement score. Apply smoothing by averaging movement scores across the last 5–10 frames to reduce false positives.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-progress-bar-0-100-that-advances-only-during-green-light-when-movement-is-detected-movement-score-exceeds-threshold-no-progress-when-player-is-still-during-green-light-reaching-100-triggers-the-won-state",
      "title": "Progress bar (0–100%) that advances only during Green Light when movement is detected (movement score exceeds threshold). No progress when player is still during Green Light. Reaching 100% triggers the won state.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-immediate-elimination-if-movement-score-exceeds-the-threshold-during-red-light-instantly-transition-to-the-eliminated-state-no-grace-period",
      "title": "Immediate elimination: if movement score exceeds the threshold during red-light, instantly transition to the eliminated state. No grace period.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-adjustable-sensitivity-slider-that-controls-the-movement-detection-threshold-lower-value-more-forgiving-higher-value-more-strict",
      "title": "Adjustable sensitivity slider that controls the movement detection threshold. Lower value = more forgiving; higher value = more strict.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-survival-timer-displayed-as-a-score-timer-starts-when-the-game-begins-after-countdown-and-stops-on-elimination-or-win",
      "title": "Survival timer displayed as a score. Timer starts when the game begins (after countdown) and stops on elimination or win.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-procedural-sound-effects-using-the-web-audio-api-no-external-audio-files-a-tense-buzzer-alarm-when-red-light-activates-a-pleasant-chime-when-green-light-activates-an-elimination-sound-when-caught-moving-and-a-victory-fanfare-on-win",
      "title": "Procedural sound effects using the Web Audio API (no external audio files): a tense buzzer/alarm when Red Light activates, a pleasant chime when Green Light activates, an elimination sound when caught moving, and a victory fanfare on win.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-display-large-status-text-during-gameplay-green-light-in-bright-green-and-red-light-in-bright-red-pink-show-idle-countdown-digits-eliminated-and-won-screens-with-appropriate-messaging-and-start-restart-buttons",
      "title": "Display large status text during gameplay: 'GREEN LIGHT' in bright green and 'RED LIGHT' in bright red/pink. Show idle, countdown digits, eliminated, and won screens with appropriate messaging and Start/Restart buttons.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-existing-2d-canvas-game-with-a-full-screen-3d-scene-using-three-js-via-react-three-fiber-the-scene-must-include-a-ground-plane-extending-toward-a-distant-finish-line-a-finish-line-marker-and-a-doll-model-mesh-at-the-far-end-of-the-track",
      "title": "Replace the existing 2D canvas game with a full-screen 3D scene using Three.js via React Three Fiber. The scene must include: a ground plane extending toward a distant finish line, a finish line marker, and a doll model/mesh at the far end of the track.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-3d-player-object-capsule-or-character-mesh-that-moves-forward-along-a-straight-track-toward-the-finish-line-the-player-s-forward-progress-must-map-to-the-existing-0-100-progress-value-reaching-100-the-finish-line-triggers-the-won-state",
      "title": "Add a 3D player object (capsule or character mesh) that moves forward along a straight track toward the finish line. The player's forward progress must map to the existing 0–100% progress value. Reaching 100% (the finish line) triggers the won state.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-third-person-camera-that-stays-slightly-behind-and-above-the-player-object-following-it-as-it-moves-forward-along-the-track",
      "title": "Implement a third-person camera that stays slightly behind and above the player object, following it as it moves forward along the track.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-integrate-mediapipe-pose-npm-package-fully-client-side-for-body-tracking-replace-the-existing-pixel-diff-movement-detection-with-smoothed-landmark-delta-calculations-using-core-body-points-shoulders-and-hips-display-the-webcam-feed-as-a-small-overlay-in-the-bottom-right-corner-of-the-screen-with-the-mediapipe-pose-skeleton-drawn-on-top-of-the-webcam-overlay-in-real-time",
      "title": "Integrate @mediapipe/pose (npm package, fully client-side) for body tracking. Replace the existing pixel-diff movement detection with smoothed landmark delta calculations using core body points (shoulders and hips). Display the webcam feed as a small overlay in the bottom-right corner of the screen, with the MediaPipe pose skeleton drawn on top of the webcam overlay in real time.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-restructure-the-frontend-code-into-modular-files-scene-ts-three-js-r3f-scene-setup-posetracking-ts-mediapipe-pose-integration-movementdetection-ts-landmark-delta-and-smoothing-logic-and-gamestate-ts-state-machine-manager-these-modules-must-be-imported-and-composed-in-the-main-app-game-component",
      "title": "Restructure the frontend code into modular files: scene.ts (Three.js/R3F scene setup), poseTracking.ts (MediaPipe Pose integration), movementDetection.ts (landmark delta and smoothing logic), and gameState.ts (state machine manager). These modules must be imported and composed in the main App/game component.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-preserve-all-existing-game-logic-in-the-3d-refactor-green-light-advances-the-3d-player-only-when-body-movement-landmark-delta-exceeds-the-threshold-red-light-causes-immediate-elimination-if-movement-exceeds-the-threshold-randomized-green-red-light-durations-3-2-1-countdown-before-game-start-survival-timer-procedural-web-audio-api-sound-effects-green-light-chime-red-light-alarm-elimination-sound-victory-fanfare-adjustable-sensitivity-slider-idle-countdown-green-light-red-light-eliminated-and-won-states-with-appropriate-ui-overlays",
      "title": "Preserve all existing game logic in the 3D refactor: Green Light advances the 3D player only when body movement (landmark delta) exceeds the threshold; Red Light causes immediate elimination if movement exceeds the threshold; randomized green/red light durations; 3-2-1 countdown before game start; survival timer; procedural Web Audio API sound effects (green light chime, red light alarm, elimination sound, victory fanfare); adjustable sensitivity slider; idle, countdown, green-light, red-light, eliminated, and won states with appropriate UI overlays.",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-webcam-overlay-so-the-live-camera-feed-is-visible-ensure-the-video-element-s-srcobject-is-correctly-assigned-from-the-getusermedia-stream-the-video-element-is-set-to-autoplay-and-playsinline-and-the-video-is-fully-loaded-and-playing-readystate-have-enough-data-or-the-playing-event-has-fired-before-any-canvas-drawing-or-mediapipe-frame-processing-begins",
      "title": "Fix the webcam overlay so the live camera feed is visible. Ensure the video element's srcObject is correctly assigned from the getUserMedia stream, the video element is set to autoplay and playsInline, and the video is fully loaded and playing (readyState >= HAVE_ENOUGH_DATA or the 'playing' event has fired) before any canvas drawing or MediaPipe frame processing begins.",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-mediapipe-pose-skeleton-so-it-renders-on-top-of-the-webcam-feed-in-the-overlay-canvas-the-pose-instance-must-only-receive-frames-via-pose-send-or-the-requestanimationframe-loop-after-the-video-element-is-confirmed-active-and-playing-ensure-the-skeleton-drawing-utility-in-posetracking-ts-is-called-with-valid-landmark-results-on-every-processed-frame-and-draws-onto-the-correct-overlay-canvas-context",
      "title": "Fix the MediaPipe Pose skeleton so it renders on top of the webcam feed in the overlay canvas. The Pose instance must only receive frames (via pose.send or the requestAnimationFrame loop) after the video element is confirmed active and playing. Ensure the skeleton drawing utility in poseTracking.ts is called with valid landmark results on every processed frame and draws onto the correct overlay canvas context.",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-dead-zone-mechanic-in-the-movement-detection-and-game-state-logic-define-the-dead-zone-as-any-movement-score-below-10-of-the-current-sensitivity-threshold-during-red-light-if-the-movement-score-falls-within-the-dead-zone-score-threshold-0-10-the-player-is-safe-and-must-not-be-eliminated-during-green-light-if-the-movement-score-falls-within-the-dead-zone-the-player-must-not-advance-no-progress-the-dead-zone-check-must-use-the-same-threshold-value-that-the-sensitivity-slider-controls-so-it-scales-proportionally-when-the-slider-is-adjusted",
      "title": "Implement a dead zone mechanic in the movement detection and game state logic: define the dead zone as any movement score below 10% of the current sensitivity threshold. During Red Light, if the movement score falls within the dead zone (score < threshold × 0.10), the player is safe and must NOT be eliminated. During Green Light, if the movement score falls within the dead zone, the player must NOT advance (no progress). The dead zone check must use the same threshold value that the sensitivity slider controls so it scales proportionally when the slider is adjusted.",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-in-movementdetection-ts-strengthen-the-dead-zone-check-so-that-any-movement-score-strictly-below-threshold-0-10-is-clamped-to-zero-before-being-returned-the-raw-smoothed-score-must-be-evaluated-against-the-dead-zone-boundary-first-and-if-it-falls-within-the-dead-zone-the-exported-movement-score-must-be-0-not-the-raw-value-this-ensures-downstream-game-logic-in-usegamestate-ts-and-gamestate-ts-never-receives-a-non-zero-score-for-sub-dead-zone-motion",
      "title": "In movementDetection.ts, strengthen the dead zone check so that any movement score strictly below (threshold × 0.10) is clamped to zero before being returned. The raw smoothed score must be evaluated against the dead zone boundary first, and if it falls within the dead zone, the exported movement score must be 0 — not the raw value. This ensures downstream game logic in useGameState.ts and gameState.ts never receives a non-zero score for sub-dead-zone motion.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-in-gamestate-ts-add-an-explicit-guard-in-the-elimination-check-logic-before-transitioning-to-eliminated-assert-that-the-movement-score-is-strictly-greater-than-threshold-0-10-if-the-score-is-at-or-below-that-boundary-the-elimination-transition-must-be-blocked-unconditionally-acting-as-a-second-line-of-defence-independent-of-the-clamping-in-movementdetection-ts",
      "title": "In gameState.ts, add an explicit guard in the elimination-check logic: before transitioning to 'eliminated', assert that the movement score is strictly greater than (threshold × 0.10). If the score is at or below that boundary, the elimination transition must be blocked unconditionally, acting as a second line of defence independent of the clamping in movementDetection.ts.",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    },
    {
      "id": "feature-in-usegamestate-ts-ensure-the-movement-score-consumed-for-phase-transition-decisions-comes-from-the-post-dead-zone-clamped-value-returned-by-movementdetection-ts-remove-or-replace-any-intermediate-computation-that-re-evaluates-the-raw-landmark-delta-directly-against-the-sensitivity-threshold-without-the-dead-zone-clamp-applied",
      "title": "In useGameState.ts, ensure the movement score consumed for phase-transition decisions comes from the post-dead-zone-clamped value returned by movementDetection.ts. Remove or replace any intermediate computation that re-evaluates the raw landmark delta directly against the sensitivity threshold without the dead zone clamp applied.",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-in-movementdetection-ts-replace-the-existing-frame-averaging-smoothing-with-exponential-smoothing-using-the-formula-smootheddelta-prevdelta-0-8-currentdelta-0-2-the-previous-smoothed-value-must-persist-between-frames-not-reset-per-call-so-the-exponential-decay-accumulates-correctly-across-the-animation-loop",
      "title": "In movementDetection.ts, replace the existing frame-averaging smoothing with exponential smoothing using the formula: smoothedDelta = (prevDelta × 0.8) + (currentDelta × 0.2). The previous smoothed value must persist between frames (not reset per call) so the exponential decay accumulates correctly across the animation loop.",
      "reqIds": [
        "REQ-22"
      ],
      "version": 1
    },
    {
      "id": "feature-in-movementdetection-ts-restrict-landmark-tracking-to-shoulders-indices-11-12-hips-indices-23-24-and-nose-index-0-only-remove-any-calculations-that-include-wrists-indices-15-16-or-ankles-indices-27-28-from-the-movement-delta-computation-average-movement-across-only-these-stable-landmarks",
      "title": "In movementDetection.ts, restrict landmark tracking to shoulders (indices 11, 12), hips (indices 23, 24), and nose (index 0) only. Remove any calculations that include wrists (indices 15, 16) or ankles (indices 27, 28) from the movement delta computation. Average movement across only these stable landmarks.",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-in-movementdetection-ts-apply-a-configurable-base-movement-threshold-default-value-in-the-range-0-02-0-05-as-a-pre-filter-before-the-dead-zone-clamp-any-per-landmark-delta-below-this-base-threshold-must-be-treated-as-zero-before-it-enters-the-smoothing-pipeline-preventing-micro-movements-from-accumulating-in-the-smoothed-score",
      "title": "In movementDetection.ts, apply a configurable base movement threshold (default value in the range 0.02–0.05) as a pre-filter before the dead-zone clamp. Any per-landmark delta below this base threshold must be treated as zero before it enters the smoothing pipeline, preventing micro-movements from accumulating in the smoothed score.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-in-gamestate-ts-and-usegamestate-ts-implement-a-time-confirmation-window-for-elimination-when-in-the-red-light-phase-start-a-timer-the-first-time-the-movement-score-exceeds-the-elimination-threshold-only-transition-to-the-eliminated-state-if-the-score-has-remained-continuously-above-the-threshold-for-at-least-200ms-if-the-score-drops-below-the-threshold-before-the-window-elapses-reset-the-timer-without-triggering-elimination",
      "title": "In gameState.ts and useGameState.ts, implement a time confirmation window for elimination: when in the red-light phase, start a timer the first time the movement score exceeds the elimination threshold. Only transition to the 'eliminated' state if the score has remained continuously above the threshold for at least 200ms. If the score drops below the threshold before the window elapses, reset the timer without triggering elimination.",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-in-movementdetection-ts-make-the-exponential-smoothing-asymmetric-when-the-current-per-landmark-delta-after-base-threshold-pre-filter-is-zero-or-below-the-base-threshold-meaning-the-player-has-stopped-moving-reset-the-smoothed-score-to-zero-immediately-rather-than-decaying-it-gradually-only-apply-the-slow-decay-formula-smootheddelta-prevdelta-0-8-currentdelta-0-2-when-active-movement-is-detected-this-ensures-the-exported-movement-score-drops-to-zero-the-moment-no-movement-is-registered-eliminating-the-perceived-lag-when-the-player-freezes",
      "title": "In movementDetection.ts, make the exponential smoothing asymmetric: when the current per-landmark delta (after base-threshold pre-filter) is zero or below the base threshold — meaning the player has stopped moving — reset the smoothed score to zero immediately rather than decaying it gradually. Only apply the slow decay formula (smoothedDelta = prevDelta × 0.8 + currentDelta × 0.2) when active movement is detected. This ensures the exported movement score drops to zero the moment no movement is registered, eliminating the perceived lag when the player freezes.",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Dead zone mechanic: movement below 10% of the threshold during Red Light = safe (no elimination); during Green Light = no progress. Applies relative to the current sensitivity threshold.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Anti-false-elimination improvements: (1) configurable movement threshold 0.02–0.05, (2) exponential smoothing (prevDelta×0.8 + currentDelta×0.2), (3) stable landmarks only (shoulders, hips, nose — drop wrists/ankles), (4) time confirmation window of 200–300ms before elimination triggers.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Reduce smoothing delay when player stops moving — movement score should drop to zero (or near-zero) immediately when no movement is detected, rather than decaying slowly.",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "gameProjectType": "3d",
  "projectName": "Squid Game: Red Light, Green Light",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}